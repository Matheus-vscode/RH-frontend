<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema RH</title>
  <style>
    body { margin: 0; font-family: Arial, sans-serif; display: flex; height: 100vh; }
    aside { width: 220px; background: #1e293b; color: white; padding: 20px; }
    aside h1 { font-size: 20px; margin-bottom: 20px; }
    aside button { display: block; width: 100%; margin-bottom: 10px; padding: 10px; border: none; background: #334155; color: white; cursor: pointer; }
    aside button.active { background: #0f172a; font-weight: bold; }
    main { flex: 1; padding: 20px; }
    h2 { margin-top: 0; }
    table { width: 100%; border-collapse: collapse; margin-top: 15px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    th { background: #f1f5f9; }
    .actions button { margin-right: 5px; }
    .top-bar { display: flex; justify-content: space-between; align-items: center; }
    .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.6); align-items: center; justify-content: center; }
    .modal-content { background: white; padding: 20px; border-radius: 8px; width: 600px; max-width: 90%; }
    .tabs { display: flex; margin-bottom: 10px; }
    .tabs button { flex: 1; padding: 8px; border: none; cursor: pointer; background: #e2e8f0; }
    .tabs button.active { background: #cbd5e1; font-weight: bold; }
    .tab-pane { display: none; }
    .tab-pane.active { display: block; }
    label { display: block; margin-top: 10px; }
    input, select { width: 100%; padding: 6px; margin-top: 4px; }
  </style>
</head>
<body>

  <!-- Sidebar -->
  <aside>
    <h1>Sistema RH</h1>
    <button id="btnFuncionarios" class="active">Funcionários</button>
    <button id="btnAfastamentos">Afastamentos</button>
  </aside>

  <!-- Main -->
  <main>
    <!-- Funcionários -->
    <section id="secFuncionarios">
      <div class="top-bar">
        <h2>Funcionários</h2>
        <button onclick="openModal('employee')">Adicionar</button>
      </div>
      <table>
        <thead>
          <tr>
            <th>Nome</th><th>Email</th><th>Cargo</th><th>Salário</th><th>Ações</th>
          </tr>
        </thead>
        <tbody id="empTable"></tbody>
      </table>
    </section>

    <!-- Afastamentos -->
    <section id="secAfastamentos" style="display:none;">
      <div class="top-bar">
        <h2>Afastamentos</h2>
        <button onclick="openModal('away')">Adicionar</button>
      </div>
      <table>
        <thead>
          <tr>
            <th>Funcionário</th><th>Motivo</th><th>Data Início</th><th>Data Fim</th><th>Ações</th>
          </tr>
        </thead>
        <tbody id="awayTable"></tbody>
      </table>
    </section>
  </main>

  <!-- Modal -->
  <div id="modal" class="modal">
    <div class="modal-content">
      <h3 id="modalTitle">Cadastro</h3>
      <div class="tabs">
        <button id="tabDados" class="active" onclick="switchTab('dados')">Dados Pessoais</button>
        <button id="tabProf" onclick="switchTab('prof')">Profissional</button>
        <button id="tabFin" onclick="switchTab('fin')">Financeiro</button>
      </div>

      <!-- Form Funcionário -->
      <form id="employeeForm" class="tab-pane active">
        <input type="hidden" id="empId">
        <label>Nome:<input type="text" id="empNome"></label>
        <label>Email:<input type="email" id="empEmail"></label>
        <label>Telefone:<input type="text" id="empTel"></label>
      </form>

      <form id="employeeProf" class="tab-pane">
        <label>Cargo:<input type="text" id="empCargo"></label>
        <label>Departamento:<input type="text" id="empDept"></label>
      </form>

      <form id="employeeFin" class="tab-pane">
        <label>Salário:<input type="number" id="empSalario"></label>
        <label>Benefícios:<input type="text" id="empBeneficios"></label>
      </form>

      <!-- Form Afastamento -->
      <form id="awayForm" style="display:none;">
        <input type="hidden" id="awayId">
        <label>Funcionário:<input type="text" id="awayFuncionario"></label>
        <label>Motivo:<input type="text" id="awayMotivo"></label>
        <label>Data Início:<input type="date" id="awayInicio"></label>
        <label>Data Fim:<input type="date" id="awayFim"></label>
      </form>

      <div style="margin-top:15px;">
        <button onclick="saveData()">Salvar</button>
        <button onclick="closeModal()">Cancelar</button>
      </div>
    </div>
  </div>

<script>
  let currentSection = 'employee'; // employee ou away

  // Navegação sidebar
  document.getElementById('btnFuncionarios').onclick = () => showSection('employee');
  document.getElementById('btnAfastamentos').onclick = () => showSection('away');

  function showSection(sec) {
    currentSection = sec;
    document.getElementById('secFuncionarios').style.display = sec === 'employee' ? 'block' : 'none';
    document.getElementById('secAfastamentos').style.display = sec === 'away' ? 'block' : 'none';
    document.getElementById('btnFuncionarios').classList.toggle('active', sec === 'employee');
    document.getElementById('btnAfastamentos').classList.toggle('active', sec === 'away');
  }

  // Modal
  function openModal(type, data = null) {
    document.getElementById('modal').style.display = 'flex';
    document.getElementById('employeeForm').style.display = type === 'employee' ? 'block' : 'none';
    document.getElementById('employeeProf').style.display = type === 'employee' ? 'block' : 'none';
    document.getElementById('employeeFin').style.display = type === 'employee' ? 'block' : 'none';
    document.querySelector('.tabs').style.display = type === 'employee' ? 'flex' : 'none';
    document.getElementById('awayForm').style.display = type === 'away' ? 'block' : 'none';
    currentSection = type;
    if (data) fillForm(type, data);
  }
  function closeModal() { document.getElementById('modal').style.display = 'none'; }

  // Tabs
  function switchTab(tab) {
    document.getElementById('employeeForm').classList.remove('active');
    document.getElementById('employeeProf').classList.remove('active');
    document.getElementById('employeeFin').classList.remove('active');
    document.getElementById('tabDados').classList.remove('active');
    document.getElementById('tabProf').classList.remove('active');
    document.getElementById('tabFin').classList.remove('active');
    if (tab === 'dados') { document.getElementById('employeeForm').classList.add('active'); document.getElementById('tabDados').classList.add('active'); }
    if (tab === 'prof') { document.getElementById('employeeProf').classList.add('active'); document.getElementById('tabProf').classList.add('active'); }
    if (tab === 'fin') { document.getElementById('employeeFin').classList.add('active'); document.getElementById('tabFin').classList.add('active'); }
  }

  // Carregar dados
  async function loadData() {
    if (currentSection === 'employee') {
      let res = await fetch('/employees');
      let data = await res.json();
      let html = '';
      data.forEach(emp => {
        html += `<tr>
          <td>${emp.nome}</td>
          <td>${emp.email}</td>
          <td>${emp.cargo}</td>
          <td>${emp.salario}</td>
          <td class="actions">
            <button onclick='openModal("employee", ${JSON.stringify(emp)})'>Editar</button>
            <button onclick='deleteData("employee", ${emp.id})'>Excluir</button>
          </td>
        </tr>`;
      });
      document.getElementById('empTable').innerHTML = html;
    } else {
      let res = await fetch('/away');
      let data = await res.json();
      let html = '';
      data.forEach(aw => {
        html += `<tr>
          <td>${aw.funcionario}</td>
          <td>${aw.motivo}</td>
          <td>${aw.data_inicio}</td>
          <td>${aw.data_fim}</td>
          <td class="actions">
            <button onclick='openModal("away", ${JSON.stringify(aw)})'>Editar</button>
            <button onclick='deleteData("away", ${aw.id})'>Excluir</button>
          </td>
        </tr>`;
      });
      document.getElementById('awayTable').innerHTML = html;
    }
  }

  // Preencher formulário
  function fillForm(type, data) {
    if (type === 'employee') {
      document.getElementById('empId').value = data.id || '';
      document.getElementById('empNome').value = data.nome || '';
      document.getElementById('empEmail').value = data.email || '';
      document.getElementById('empTel').value = data.telefone || '';
      document.getElementById('empCargo').value = data.cargo || '';
      document.getElementById('empDept').value = data.departamento || '';
      document.getElementById('empSalario').value = data.salario || '';
      document.getElementById('empBeneficios').value = data.beneficios || '';
    } else {
      document.getElementById('awayId').value = data.id || '';
      document.getElementById('awayFuncionario').value = data.funcionario || '';
      document.getElementById('awayMotivo').value = data.motivo || '';
      document.getElementById('awayInicio').value = data.data_inicio || '';
      document.getElementById('awayFim').value = data.data_fim || '';
    }
  }

  // Salvar
  async function saveData() {
    if (currentSection === 'employee') {
      const emp = {
        id: document.getElementById('empId').value,
        nome: document.getElementById('empNome').value,
        email: document.getElementById('empEmail').value,
        telefone: document.getElementById('empTel').value,
        cargo: document.getElementById('empCargo').value,
        departamento: document.getElementById('empDept').value,
        salario: document.getElementById('empSalario').value,
        beneficios: document.getElementById('empBeneficios').value,
      };
      await fetch('/employees' + (emp.id ? '/' + emp.id : ''), {
        method: emp.id ? 'PUT' : 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(emp)
      });
    } else {
      const aw = {
        id: document.getElementById('awayId').value,
        funcionario: document.getElementById('awayFuncionario').value,
        motivo: document.getElementById('awayMotivo').value,
        data_inicio: document.getElementById('awayInicio').value,
        data_fim: document.getElementById('awayFim').value,
      };
      await fetch('/away' + (aw.id ? '/' + aw.id : ''), {
        method: aw.id ? 'PUT' : 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(aw)
      });
    }
    closeModal(); loadData();
  }

  // Excluir
  async function deleteData(type, id) {
    await fetch('/' + type + '/' + id, { method: 'DELETE' });
    loadData();
  }

  // Inicializar
  loadData();
</script>

</body>
</html>



